<div id="map"></div>

<script>
  function initMap() {
    let center = {lat: 0.000, lng: 0.000};

    let disasters = [];
    <% @disasters.each do |disaster| %>
      disasters.push({
        location: {
          lat: <%= disaster.latitude %>,
          lng: <%= disaster.longitude %>
        },
        info: '<%= link_to "#{disaster.type} in #{disaster.country}", disaster_path(disaster.rw_id) %>'
      })
    <% end %>

    let map = new google.maps.Map(document.getElementById("map"), {
      zoom: 2,
      center: center
    });

    disasters.forEach(disaster => {
      let marker = new google.maps.Marker({
        position: disaster.location,
        map: map
      });
      attachMarkerInfo(marker, String(disaster.info))
    });
  };

  function attachMarkerInfo(marker, content) {
    let infowindow = new google.maps.InfoWindow({
      content: content
    });
    marker.addListener('click', () => {
      infowindow.open(marker.get('map'), marker);
    });
  };
</script>
